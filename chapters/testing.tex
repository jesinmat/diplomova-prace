\chapter{Testování}

Tato kapitola popisuje proces testování aplikace. Aplikace byla průběžně testována uživateli během vývoje, API bylo testováno pomocí automatizovaných testů.

\section{Testování uživateli}

Od začátku vývoje byla aplikace dostupná na dočasné webové adrese, ke které měli přístup organizátoři akce SummerJob. Tito organizátoři aplikaci průběžně testovali,
čímž ověřovali splnění funkčních požadavků a poskytovali zpětnou vazbu. Na testování se podíleli zejména vedoucí práce, Ing. Marek Jílek, a Bc. Lucie Anna Procházková,
dlouholetí organizátoři akce SummerJob. Dále se na zkušebním provozu mohli podílet i další organizátoři akce SummerJob, kteří aplikaci testovali v menší míře.

Pomocí tohoto procesu bylo zjištěno několik nedostatků, které byly následně odstraněny. Jednalo se zejména o specifické požadavky pro akci SummerJob, které nebyly
v původním návrhu specifikovány. 

\section{Testování API}

Pro zajištění správné funkcionality API byly vytvořeny automatizované testy. Tyto testy ověřují, že API vrací očekávaná data a že nedochází k chybám při zpracování požadavků.
Testy byly vytvořeny pomocí knihoven Chai a Mocha, rozšířené o knihovnu supertest pro testování HTTP požadavků.
Vzhledem k použité metodě přihlašování není možné automaticky generovat přístupový token, na začátku testů je tedy v databázi automaticky
vytvořen uživatel s administrátorským účtem a do tabulky aktivních přihlášení je vložen uměle vytvořený token. 

Testování probíhá na produkční verzi webové aplikace s prázdnou databází. Testy pokrývají téměř všechny dostupné endpointy API, aby bylo možné
ověřit, že všechny funkce API fungují správně. Výjimku tvoří endpointy pro přihlášení pomocí e-mailu, které vzhledem k povaze přihlášení nelze 
pomocí API testů snadno otestovat. Pro kontrolu jednotlivých API endpointů je možné využít nástroj Swagger UI, který je dostupný ve vývojovém režimu aplikace.

\subsection{Ukázka testů}

TODO: popsat chai, mocha, supertest, cookies


\begin{minted}[linenos]{javascript}
describe("Plans", function () {
  it("deletes a plan", async function () {
    // Create a plan
    const plan = await api.post(
      "/api/plans",
      Id.PLANS,
      createPlanData(api.getSummerJobEventStart())
    );
    // Get all plans before the plan is deleted
    const plansBefore = await api.get("/api/plans", Id.PLANS);
    // Delete the created plan
    const deleted = await api.del(
        `/api/plans/${plan.body.id}`,
        Id.PLANS
    );
    deleted.status.should.equal(204);
    // Check that the plan was deleted from the list
    const plansAfter = await api.get("/api/plans", Id.PLANS);
    plansAfter.body
        .should.have.lengthOf(plansBefore.body.length - 1);
    plansAfter.body.map(_plan => _plan.id)
        .should.not.contain(plan.body.id);
  });
});
\end{minted}
